!function(){function e(){if("http://localhost:3000"!=u&&"https://localhost:3000"!=u&&"http://10.0.2.2:3000"!=u&&"http://localhost:8888"!=u&&"samoanhighlandretreat.com"!=location.host)return!1;for(var e=0;e<arguments.length;e++)console.log(arguments[e])}function t(t,r,o,a,n,i){var d=t;e("Match:",t);var l=d.match(/powr-[^\s\]]*/i),s=d.match(/id="[^"]*"/i);null==s&&(s=d.match(/id='[^']*'/i)),null==s&&(s=d.match(/id=[^\]]*/i),null!=s&&(s=s[0].replace("id=",'id="')+'"')),null==s&&(s=d.match(/label="[^"]*"/i)),null==s&&(s=d.match(/label='[^']*'/i)),null==s&&(s="");var u='<div class="'+l+'" '+s+"></div>";return e("Result is:"+u),u}function r(e){var t={},r=e.search("\\?");e=e.substr(r+1);for(var o=e.split("&"),a=0;a<o.length;a++){var n=o[a].split("=");if("undefined"==typeof t[n[0]])t[n[0]]=n[1];else if("string"==typeof t[n[0]]){var i=[t[n[0]],n[1]];t[n[0]]=i}else t[n[0]].push(n[1])}return t}function o(){var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("msie")?parseInt(e.split("msie")[1]):!1}function a(e){for(var t=!1,r=e;r&&r!==document;r=r.parentNode)if(void 0!=r.classList&&r.classList.contains("powr-ignore")){t=!0;break}return t}function n(){try{return window.top.location.href}catch(t){return e("Couldn't get page url:",t),""}}function i(t,r,o){function a(){var a={message:"loaded",data:{iframe_index:r,parent_window_width:window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,parent_window_height:window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight}};e("POWr.js sending load message to url"+o+"; iframe:",t),t.contentWindow.postMessage(JSON.stringify(a),o)}t.addEventListener?t.addEventListener("load",a):t.attachEvent("onload",a)}function d(t,r){var o=new XMLHttpRequest;o.open("GET",r,!0),o.withCredentials=!0,o.onreadystatechange=function(){if(e("Async ready state change!",o),o.readyState==XMLHttpRequest.DONE||4==o.readyState)if(200==o.status){e("POWr App Data:",o.responseText);var r=JSON.parse(o.responseText);r.iframe_index=t,POWR_RECEIVERS[t].data=r;var a=setInterval(function(){POWR_RECEIVERS[t].loaded&&(POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"loadView",data:r}),POWR_RECEIVERS[t].url),clearInterval(a))},10)}else e("Error receiving POWr App Data")},o.send()}function l(t){e("Settings got a message!",t);try{var r=JSON.parse(t.data);if("viewLoaded"==r.message){e("Settings received view loaded");var o=r.data.iframe_index;POWR_RECEIVERS[o].loaded=!0}else if("updateSize"==r.message)if("undefined"!=typeof gadgets&&"undefined"!=typeof gadgets.window&&"undefined"!=typeof gadgets.window.adjustHeight)gadgets.window.adjustHeight(r.data.height);else{var o=r.data.iframe_index,a=document.querySelectorAll('[powrindex="'+o+'"]')[0];if(a.height=r.data.height+"px",a.style.height=r.data.height+"px",void 0!=r.data.postCss)for(var n in r.data.postCss)a.style[n]=r.data.postCss[n];e("Updating size of el",a)}else if("loadMe"==r.message){e("Settings received loadMe request");var o=r.data.iframe_index;void 0!=POWR_RECEIVERS[o]&&void 0!=POWR_RECEIVERS[o].data&&POWR_RECEIVERS[o].receiver.postMessage(JSON.stringify({message:"loadView",data:POWR_RECEIVERS[o].data}),POWR_RECEIVERS[o].url)}}catch(i){e("Error with message",i)}}function s(e){if(80==e.keyCode&&(g=!0,setTimeout(function(){g=!1},2e3)),38==e.keyCode&&g){for(var t=0;t<POWR_RECEIVERS.length;t++)POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"showEdit"}),POWR_RECEIVERS[t].url);return e.preventDefault(),!1}if(40==e.keyCode&&g){for(var t=0;t<POWR_RECEIVERS.length;t++)POWR_RECEIVERS[t].receiver.postMessage(JSON.stringify({message:"hideEdit"}),POWR_RECEIVERS[t].url);return e.preventDefault(),!1}}var u="https://www.powr.io",c="https://www.powr.io";if("undefined"!=typeof loadPowr)return void e("Powr already loaded");window.addEventListener?window.addEventListener("message",l):window.attachEvent("onmessage",l);var p=0;POWR_RECEIVERS=[],loadPowr=function(){for(var l=null,s=null,v=null,g=!1,w=document.querySelectorAll("script"),m=0;m<w.length;m++){var h=w[m],f=h.getAttribute("src");if(void 0!=f){var E=h.getAttribute("powr-token"),y=h.getAttribute("external-type"),R=h.getAttribute("template-powr-token"),_=h.getAttribute("powr-load");if(void 0==_&&(_="async"),o()&&o()<=9&&(_="sync"),g=h.getAttribute("demo-mode"),void 0!=E?l=E:f.search("powr-token")>-1&&(v=r(f),e("powr token present in query, query obj: ",v),void 0!==v["powr-token"]&&v["powr-token"].length>0&&(l=v["powr-token"])),void 0!=y?s=y:f.search("external-type")>-1&&(v=r(f),void 0!=v["external-type"]&&v["external-type"].length>0&&(s=v["external-type"])),void 0!=l||void 0!=s)break}}if(null==l||0==l.length)try{l=window.top.location.host}catch(b){l=""}var S=!0;if(S){for(var C=/\[powr-[^\]]*\]/gi,O=/\[powr-[^\s\]]*/gi,P=document.querySelectorAll("a"),m=0;m<P.length;m++){var A=P[m];if(!a(A)){var I=A.previousSibling,W=A.nextSibling;if(I&&W&&A.getAttribute("href")&&A.getAttribute("href").search("tel")>-1&&3==I.nodeType&&3==W.nodeType&&I.nodeValue.match(O)&&W.nodeValue.search("]")>-1){var L=A.innerHTML,V=I.nodeValue.match(/powr-[^\s\]]*/gi)[0],x=document.createElement("div");x.innerHTML='<div class="'+V+'" label="'+L+'"></div>',I.parentNode.removeChild(I),W.parentNode.removeChild(W),A.parentNode.replaceChild(x,A)}}}for(var P=document.querySelectorAll("body, body *"),m=0;m<P.length;m++){var A=P[m],N=A.childNodes;if(!a(A))for(var k=0;k<N.length;k++){var T=N[k];if(3==T.nodeType){var q=T.nodeValue,M=q.replace(C,t);if(M!=q){var x=document.createElement("div");x.innerHTML=M,A.replaceChild(x,T)}}}}}if(0==document.querySelectorAll("#powrIframeLoader").length){var H=document.createElement("div"),J=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];H.id="powrIframeLoader",H.innerHTML="&shy;<style> .powrLoaded iframe { visibility: hidden; } </style>",J.parentNode.insertBefore(H,J)}for(var B=document.querySelectorAll("[class*=powr-]"),m=0;m<B.length;m++){var U=B[m];if(!(a(U)||U.className.search("powrLoaded")>-1)){U.className+=" powrLoaded";for(var j=U.className.split(/\s+/),m=0;m<j.length;m++)if(0===j[m].toLowerCase().search("powr-")){var D=j[m].toLowerCase().replace("powr-","");break}if("undefined"==typeof D)return;var z=U.getAttribute("label");void 0==z&&(z=""),void 0==R&&(R="");var X=U.getAttribute("id");void 0==X&&(X="");var G=U.getAttribute("view-mode");e("Unique label is "+X);var F="true"==g||"true"==U.getAttribute("demo-mode")?!0:!1,K=u+"/plugins/"+D+"/cached_view?load="+_+"&index="+p+"&unique_label="+X+"&powr_token="+l+"&user_label="+encodeURIComponent(z)+"&demo_mode="+F,Q=c+"/plugins/"+D+"/view.json?unique_label="+X+"&powr_token="+l+"&user_label="+encodeURIComponent(z)+"&demo_mode="+F;void 0!=s&&(Q+="&external_type="+s,K+="&external_type="+s),void 0!=R&&(Q+="&template_powr_token="+R,K+="&template_powr_token="+R),void 0!=G&&(Q+="&view_mode="+G,K+="&view_mode="+G),e("page url IS "+n()),n()&&(Q+="&url="+encodeURIComponent(n())),Q+="&request_url="+encodeURIComponent(document.location.protocol+"//"+document.location.host);var Y=document.createElement("iframe");Y.src=K,Y.setAttribute("powrindex",p),Y.width="100%",Y.height="100%",Y.frameBorder="0",Y.style.visibility="visible",Y.setAttribute("webkitallowfullscreen",""),Y.setAttribute("mozallowfullscreen",""),Y.setAttribute("allowfullscreen","");try{/iPhone|iPod|iPad/.test(navigator.userAgent)&&(Y.style.minWidth="100%",Y.style.width="1px",Y.setAttribute("scrolling","no"))}catch(Z){console.log("Err: "+Z)}i(Y,p,K),U.appendChild(Y);var $=Y.contentWindow;POWR_RECEIVERS.push({receiver:$,url:K}),"async"==_&&d(p,Q),p++}}};for(var v=0;10>v;v++)setTimeout(function(){loadPowr()},2e3*v);window.addEventListener?window.addEventListener("load",loadPowr):window.attachEvent("onload",loadPowr);var g=!1;window.addEventListener?window.addEventListener("keydown",s):window.attachEvent("onkeydown",s)}();
